{% extends 'base/base.html' %}

{% block content %}
<!DOCTYPE html>
<html>
<head>
  <title>Driver Management</title>
  <!-- Include necessary Bootstrap CSS and JavaScript files here -->
</head>
<body>
  <h1>Driver Management</h1>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <div class="row">
    <div class="col-4">
      <div class="list-group" id="list-tab" role="tablist">
        <a class="list-group-item list-group-item-action" id="list-add-driver-list" data-bs-toggle="list" href="#list-add-driver-content" role="tab" aria-controls="list-add-driver" onclick="openTab('addDriver')">Add Driver</a>
        <a class="list-group-item list-group-item-action" id="list-assign-driver-list" data-bs-toggle="list" href="#list-assign-driver-content" role="tab" aria-controls="list-assign-driver" onclick="openTab('assignDriver')">Assign Driver</a>
        <a class="list-group-item list-group-item-action" id="list-remove-driver-list" data-bs-toggle="list" href="#list-remove-driver-content" role="tab" aria-controls="list-remove-driver" onclick="openTab('removeDriver')">Remove Driver</a>
        <a class="list-group-item list-group-item-action" id="list-driver-profile-list" data-bs-toggle="list" href="#list-driver-profile-content" role="tab" aria-controls="list-driver-profile">Driver Profile</a>
        <a class="list-group-item list-group-item-action viewdivertable" id="list-view-driver" data-bs-toggle="list" href="#list-view-driver-content" role="tab" aria-controls="list-view-driver-content">View Drivers</a>
      </div>
    </div>

    <div class="col-8">
      <!-- Add Driver Tab Content -->
      <div class="tab-pane fade" id="list-add-driver-content" role="tabpanel" aria-labelledby="list-add-driver">
        <h2 id="addDriverTitle" style="display: none;">Enter Driver Details</h2>
        <form id="addDriverForm" name="addDrivers" style="display: none;">
          {% csrf_token %}
        <div class="row">
            <div class="col-md-6">
                <h3>Address Details</h3>
                <label for="address-street">Street:</label>
                <input id="streetid" type="text" name="address-street" required><br><br>
                <label for="address-city">City:</label>
                <input id="cityid" type="text" name="address-city" required><br><br>
                <label for="address-province">Province:</label>
                <input id="provinceid" type="text" name="address-province" required><br><br>
                <label for="address-zipcode">ZipCode:</label>
                <input id="zipcodeid" type="text" name="address-zipcode" required><br><br>
                <label for="address-country">Country:</label>
                <input id="countryid" type="text" name="address-country" required><br><br>
            </div>
            <div class="col-md-6">

                <label for="drivername">DriverName:</label>
                <input type="text" name="drivername" required><br><br>
                <label for="mobilenumber">MobileNumber:</label>
                <input type="text" name="mobilenumber" required><br><br>
                <label for="licensenumber">LicenseNumber:</label>
                <input type="text" name="licensenumber" required><br><br>
                <label for="salary">Salary:</label>
                <input type="number" name="salary" required><br><br>
                <button id="addDriver" type="button">Add Driver</button>
            </div>
        </div>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            $(document).ready(function() {

                $("#addDriver").click(function() {
                  console.log("HEEEEEEEEEEE",);
                    var addressData = {
                        Street: $("#streetid").val(),
                        City: $("#cityid").val(),
                        Province: $("#provinceid").val(),
                        Country: $("#countryid").val(),
                        ZipCode: $("#zipcodeid").val()
                    };

                    var driverData = {
                      DriverName: $("input[name='drivername']").val(),
                      LicenseNumber: $("input[name='licensenumber']").val(),
                      Salary: $("input[name='salary']").val(),
                      MobileNumber: $("input[name='mobilenumber']").val()
                  };
                    
                    console.log("ADDRESSSS", addressData)
                    {% comment %} console.log("Roleee", roleData) {% endcomment %}
                    // Send driver, address, and role data to the backend
                    $.ajax({
                        url: '/driver/insert/',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify({
                            DriverData: driverData,
                            AddressData: addressData,
                        }),
                        dataType: 'json',
                        contentType: 'application/json',
                        success: function(data) {
                            alert(data.message);
                        },
                        error: function(error) {
                            alert('Failed to add driver.');
                        }
                    });
                });
            });
        </script>
    </form>
</div>

      <!-- Assign Driver Tab Content -->
      <div class="tab-pane fade" id="list-assign-driver-content" role="tabpanel" aria-labelledby="list-assign-driver">
        <h2 id="assignDriverTitle" style="display: none;">Assign Driver</h2>
        <form id="assignDriverForm" name="assignDriver" method="post" action="../assigndriver/" style="display: none;">
          {% csrf_token %}
          <label for="driverid_assign">DriverID:</label>
          <input type="number" name="driverid_assign" required><br><br>
          
          <!-- Add additional fields for assigning driver -->
          <!-- For example: Vehicle ID, Assignment Date, etc. -->
          
          <button type="submit" id="assignDriver">Assign Driver</button>
        </form>
      </div>

      <!-- Remove Driver Tab Content -->
      <div class="tab-pane fade" id="list-remove-driver-content" role="tabpanel" aria-labelledby="list-remove-driver">
        <h2 id="removeDriverTitle" style="display: none;">Remove Driver</h2>
        <form id="removeDriverForm" name="removeDriver" method="post" action="../removedriver/" style="display: none;">
          {% csrf_token %}
          <label for="driverid_remove">DriverID:</label>
          <input type="number" name="driverid_remove" required><br><br>
          
          <!-- Add additional fields for removing driver -->
          <!-- For example: Confirmation, Reason, etc. -->
          
          <button type="submit" id="removeDriver">Remove Driver</button>
        </form>
      </div>

      <!-- Include Driver Profile Tab Content here -->
    </div>
  </div>

  <script>
    function openTab(tabName) {
      const tabTitle = document.getElementById(`${tabName}Title`);
      const tabForm = document.getElementById(`${tabName}Form`);

      // Display the tab content title and form
      tabTitle.style.display = "block";
      tabForm.style.display = "block";

      // Hide other tab content titles and forms
      const otherTabs = ['addDriver', 'assignDriver', 'removeDriver'];
      otherTabs.forEach(otherTab => {
        if (otherTab !== tabName) {
          const otherTabTitle = document.getElementById(`${otherTab}Title`);
          const otherTabForm = document.getElementById(`${otherTab}Form`);
          otherTabTitle.style.display = "none";
          otherTabForm.style.display = "none";
        }
      });
    }
  </script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <div class="tab-pane fade" id="list-view-driver-content" role="tabpanel" aria-labelledby="list-view-driver">
    <h2>Driver List</h2>
    <form id="viewDriverForm" name="viewDriver" method="get" action="driverApi">
        {% csrf_token %}
        <table class="table table-dark table-hover" id="driver-response-table">
            <thead>
                <tr>
                    <th scope="col">DriverID</th>
                    <th scope="col">DriverName</th>
                    <th scope="col">LicenseNumber</th>
                    <th scope="col">MobileNumber</th>
                </tr>
            </thead>
            <tbody>
                <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                <script>
                    $(document).ready(function() {
                        $(".viewdivertable").click(function() {
                            $.get('/driver/', function(data) {
                                var tableBody = $("#driver-response-table tbody");
                                tableBody.empty();
                                var rows = '';
                                $.each(data, function(index, item) {
                                    var row = $("<tr>");
                                    row.append($("<td>").text(item.DriverID));
                                    row.append($("<td>").text(item.DriverName));
                                    row.append($("<td>").text(item.LicenseNumber));
                                    row.append($("<td>").text(item.MobileNumber));
                                    rows += '<tr><td>' + item.DriverID + '</td><td>' + item.DriverName + '</td><td>' + item.LicenseNumber + '</td><td>' + item.MobileNumber + '</td></tr>';
                                });
                                $('tbody').html(rows);
                            });
                        });
                    });
                </script>
            </tbody>
        </table>
    </form>
</div>
</body>
</html>
{% endblock content %}
